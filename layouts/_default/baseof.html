<!DOCTYPE html>
<html
	lang="{{ .Site.LanguageCode }}"
	dir="{{ default `ltr` .Language.LanguageDirection }}"
>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		{{- partial "head/head.html" . -}} {{- block "head" . -}}{{ end }}
	</head>
	<body class="{{ block `body-class` . }}{{ end }}">
		{{- partial "head/colorScheme" . -}} {{/* The container is wider when
		there's any activated widget */}} {{- $hasWidget := false -}} {{- range
		.Site.Params.widgets -}} {{- if gt (len .) 0 -}} {{- $hasWidget = true -}}
		{{- end -}} {{- end -}}
		<div
			class="container main-container flex on-phone--column {{ if $hasWidget }}extended{{ else }}compact{{ end }}"
		>
			{{- block "left-sidebar" . -}} {{ partial "sidebar/left.html" . }} {{- end
			-}} {{- block "right-sidebar" . -}}{{ end }}
			<main class="main full-width">{{- block "main" . }}{{- end }}</main>
		</div>
		{{ partial "footer/include.html" . }}
	</body>
</html>

{{ if .Store.Get "hasMermaid" }}
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
{{ end }}

{{ if .Store.Get "hasPlantUML" }}
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const blocks = document.querySelectorAll('pre.plantuml');
      if (!blocks.length) return;

      const server = '{{ default "https://kroki.io/plantuml" .Site.Params.plantuml.server }}';
      for (const pre of blocks) {
        const code = pre.textContent.trim();
        try {
          const res = await fetch(`${server}/svg`, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: code
          });
          if (!res.ok) throw new Error(res.statusText);
          const svg = await res.text();
          const wrapper = document.createElement('pre');
          wrapper.className = 'plantuml';
          wrapper.innerHTML = svg;
          pre.replaceWith(wrapper);
        } catch (err) {
          console.error('PlantUML render failed:', err);
          // 失败则保留原代码块以便阅读
        }
      }
    });
  </script>
{{ end }}